<?xml version="1.0"?>
<!--
#######################################################################

CCPN Data Model version 2.1.2

Autogenerated by XmlModelIo revision 1.18 on ?
  from data model element ccp.nmr.NmrCalc.MolResidueData revision ?

#######################################################################
======================COPYRIGHT/LICENSE START==========================

MolResidueData.xml: xmlmodel model for CCPN data model, MetaClass ccp.nmr.NmrCalc.MolResidueData

Copyright (C) 2007 Rasmus Fogh (CCPN Project)

=======================================================================

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.
 
A copy of this license can be found in ../../../../../license/LGPL.license
 
This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.
 
You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA


======================COPYRIGHT/LICENSE END============================

for further information, please contact :

- CCPN website (http://www.ccpn.ac.uk/)

- email: ccpn@bioc.cam.ac.uk

=======================================================================

If you are using this software for academic purposes, we suggest
quoting the following references:

===========================REFERENCE START=============================
Wim F. Vranken, Wayne Boucher, Tim J. Stevens, Rasmus
H. Fogh, Anne Pajon, Miguel Llinas, Eldon L. Ulrich, John L. Markley, John
Ionides and Ernest D. Laue (2005). The CCPN Data Model for NMR Spectroscopy:
Development of a Software Pipeline. Proteins 59, 687 - 696.

Rasmus H. Fogh, Wayne Boucher, Wim F. Vranken, Anne
Pajon, Tim J. Stevens, T.N. Bhat, John Westbrook, John M.C. Ionides and
Ernest D. Laue (2005). A framework for scientific data modeling and automated
software development. Bioinformatics 21, 1678-1684.


This file was generated with the Memops software generation framework,
and contains original contributions embedded in the framework

===========================REFERENCE END===============================
-->

<MetaClass name="MolResidueData"
 guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
 container="www.ccpn.ac.uk_Fogh_2009-04-16-16:23:57_00001"
 isAbstract="false" isDerived="false" isImplicit="false" isLeaf="false"
 isRoot="false" isSingleton="false" partitionsChildren="false"
 visibility="public_vis">
  <documentation>MolSystem.Residue data for calculations</documentation>
  <keyNames>
    <item>serial</item>
  </keyNames>
  <supertypes>
    <item>www.ccpn.ac.uk_Fogh_2009-04-16-16:23:57_00006</item>
  </supertypes>
  <taggedValues>
    <item tag="repositoryId">$Id:  $</item>
    <item tag="repositoryTag">$Name:  $</item>
  </taggedValues>


  <MetaRole name="chain"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00007"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="chain" changeability="changeable" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="true" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="0"
   noDeleteIfSet="false" partitionsChildren="false" scope="instance_level"
   visibility="public_vis">
    <documentation>MolSystem.Chain containing residue data, if there is only one chain. Otherwise None.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:54_00024</valueType>
  </MetaRole>

  <MetaAttribute name="chainCode"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00010"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="chainCode" changeability="changeable" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="true" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="0"
   scope="instance_level" visibility="public_vis">
    <documentation>Chain code of Chain containing residues - if there is only one. Otherwise None.  Derived from chainCodes</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00033</valueType>
  </MetaAttribute>

  <MetaAttribute name="chainCodes"
   guid="www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00003"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="chainCode" changeability="frozen" hicard="-1" isAbstract="false"
   isAutomatic="false" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="true" isUnique="false" locard="1"
   scope="instance_level" visibility="public_vis">
    <documentation>chainCodes corresponding to residueSeqIds. Used in two different ways. If all Residues are within a single chain, chainCodes has length one and residueSeqIds may may be empty (signifying all residues in the chain) Otherwise the length of chainCodes and residueSeqIds must be  identical, so that each residueSeqId matches the chainCode at teh same position in the list.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00033</valueType>
  </MetaAttribute>

  <MetaRole name="chains"
   guid="www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00001"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="chain" changeability="changeable" hicard="-1" isAbstract="false"
   isAutomatic="false" isDerived="true" isImplementation="false"
   isImplicit="false" isOrdered="true" isUnique="true" locard="0"
   noDeleteIfSet="false" partitionsChildren="false" scope="instance_level"
   visibility="public_vis">
    <documentation>MolSystem.Chains containing residue data. Ordered as the chainCodes attriubute</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:54_00024</valueType>
  </MetaRole>

  <MetaOperation name="getChain"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00013"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="true" opType="get"
   scope="instance_level" visibility="public_vis">
    <documentation>getter for derived link chain</documentation>
    <target>www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00007</target>
    <codeStubs>
      <item tag="java">ccp.api.molecule.MolSystem.MolSystem molSystem = getRoot().findFirstMolSystem("code", getMolSystemCode());
if (molSystem == null) 
  result = null;
else 
  result = molSystem.findFirstChain("code", getChainCode());</item>
      <item tag="python">result = self.getByNavigation('root', ('molSystems', self.molSystemCode), ('chains', self.chainCode))</item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="getChainCode"
   guid="www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00006"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="true" opType="get"
   scope="instance_level" visibility="public_vis">
    <documentation>getter for derived attribute chainCode</documentation>
    <target>www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00010</target>
    <codeStubs>
      <item tag="java">/* NBNB TBD */</item>
      <item tag="python">chainCodes = self.chainCodes
if len(chainCodes) == 1:
  result = chainCodes[0]
else:
  result = None</item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="getChains"
   guid="www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00004"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="true" opType="get"
   scope="instance_level" visibility="public_vis">
    <documentation>getter for derived link chains</documentation>
    <target>www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00001</target>
    <codeStubs>
      <item tag="java">/* NBNB TBD */</item>
      <item tag="python">molSystem = self.molSystem
if molSystem is None:
  result =  tuple()
else:
  result = tuple(molSystem.findFirstChain(code=x) for x in set(self.chainCodes))
  if None in result:
    result = tuple()
    </item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="getMolSystem"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00012"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="true" opType="get"
   scope="instance_level" visibility="public_vis">
    <documentation>getter for derived link MolSystem</documentation>
    <target>www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00008</target>
    <codeStubs>
      <item tag="java">result = getRoot().findFirstMolSystem("code", getMolSystemCode());</item>
      <item tag="python">result = self.root.findFirstMolSystem(code=self.molSystemCode)</item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="getResidues"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00015"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="true" opType="get"
   scope="instance_level" visibility="public_vis">
    <documentation>getter for derived link residues</documentation>
    <target>www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00006</target>
    <codeStubs>
      <item tag="java">/* NBNB TBD */</item>
      <item tag="python">chain = self.chain
if chain is None:
  molSystem = self.molSystem
  if molSystem is None:
    result = tuple()
  else:
    residueSeqIds = self.residueSeqIds
    result = tuple(molSystem.getByNavigation(('chains',x), ('residues', residueSeqIds[ii])) for ii,x in enumerate(self.chainCodes))
elif self.residueSeqIds:
  result = tuple(chain.findFirstResidue(seqId=x) for x in self.residueSeqIds)
else:
  result = chain.sortedResidues()
if None in result:
  result = tuple()</item>
    </codeStubs>
  </MetaOperation>

  <MetaRole name="molSystem"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00008"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="molSystem" changeability="frozen" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="true" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="0"
   noDeleteIfSet="false" partitionsChildren="false" scope="instance_level"
   visibility="public_vis">
    <documentation>MolSystem for residue data</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:54_00023</valueType>
  </MetaRole>

  <MetaAttribute name="molSystemCode"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00009"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="molSystemCode" changeability="changeable" hicard="1"
   isAbstract="false" isAutomatic="false" isDerived="false"
   isImplementation="false" isImplicit="false" isOrdered="false" isUnique="true"
   locard="1" scope="instance_level" visibility="public_vis">
    <documentation>Molsystem code of relevant MolSystem - used in deriving link to Residues</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00037</valueType>
  </MetaAttribute>

  <MetaAttribute name="residueSeqIds"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00011"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="residueSeqId" changeability="changeable" hicard="-1"
   isAbstract="false" isAutomatic="false" isDerived="false"
   isImplementation="false" isImplicit="false" isOrdered="true" isUnique="false"
   locard="0" scope="instance_level" visibility="public_vis">
    <documentation>Residue seqIds of residues linked to. If empty (and if there is only a single chain code) all residues in the chain are used.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00032</valueType>

    <!-- Start constraints for <MetaAttribute: ccp.nmr.NmrCalc.MolResidueData.residueSeqIds>: -->
    <MetaConstraint name="Either_single_chain_code_or_residueSeqIds_match_chainCodes_one_to_one"
     guid="www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00002"
     container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00011"
     isImplicit="false">
      <codeStubs>
        <item tag="java">null /* NBNB TBD */</item>
        <item tag="python">len(self.chainCodes) in (1,len(values))</item>
      </codeStubs>
    </MetaConstraint>
    <!-- End constraints for <MetaAttribute: ccp.nmr.NmrCalc.MolResidueData.residueSeqIds>: -->
  </MetaAttribute>

  <MetaRole name="residues"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00006"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   baseName="residue" changeability="changeable" hicard="-1" isAbstract="false"
   isAutomatic="false" isDerived="true" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="0"
   noDeleteIfSet="false" partitionsChildren="false" scope="instance_level"
   visibility="public_vis">
    <documentation>MolSystem.Residues used for data</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:54_00030</valueType>
  </MetaRole>

  <MetaOperation name="setChain"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00014"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="false" opType="set"
   scope="instance_level" visibility="public_vis">
    <documentation>setter for derived link chain</documentation>
    <target>www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00007</target>
    <codeStubs>
      <item tag="java">if (value == null)
  throw new memops.general.ApiException("MolResidueData.chain can not be set to null ");
else {
  if (getMolSystemCode() != value.getMolSystem().getCode() || getChainCode() != value.getCode()) {
    setChainCode(value.getCode());
    setMolSystemCode(value.getMolSystem().getCode());
  }
}</item>
      <item tag="python">if value is None:
  raise ApiError("MolResidueData.chain can not be set to None")
else:
  molSystemCode = value.molSystem.code
  chainCode = value.code
  if self.molSystemCode != molSystemCode or self.chainCode != value.code:
      self.chainCode = chainCode
      self.molSystemCode = molSystemCode</item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="setChainCode"
   guid="www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00007"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="false" opType="set"
   scope="instance_level" visibility="public_vis">
    <documentation>setter for derived attribute chainCode</documentation>
    <target>www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00010</target>
    <codeStubs>
      <item tag="java">/* NBNB TBD */</item>
      <item tag="python">if value is None:
  raise ApiError("MolResidueData.chain can not be set to None")
elif value != self.chainCode :
  wasOverride = self.root.override
  self.root.override = True
  try:
    self.chainCodes = [value]
    if not self.inConstructor:
      self.residueSeqIds = []
  finally:
    self.root.override = wasOverride</item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="setChains"
   guid="www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00005"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="false" opType="set"
   scope="instance_level" visibility="public_vis">
    <documentation>setter for derived link chains</documentation>
    <target>www.ccpn.ac.uk_Fogh_2011-03-30-18:00:04_00001</target>
    <codeStubs>
      <item tag="java">if ((values != null) &amp;&amp; !values.isEmpty()) {
  if (values.size() == 1) {
     ccp.api.molecule.MolSystem.Chain chain = values.iterator().next();
     setChain(chain);
  } else {
    java.util.Set&lt;ccp.api.molecule.MolSystem.MolSystem&gt; molSystems = new java.util.HashSet&lt;ccp.api.molecule.MolSystem.MolSystem&gt;();
    for (ccp.api.molecule.MolSystem.Chain x: values)
      molSystems.add(x.getMolSystem());
    if (molSystems.size() == 1) {
      java.lang.String molSystemCode = molSystems.iterator().next().getCode();
      if (getMolSystemCode() != molSystemCode) {
        java.util.List&lt;java.lang.String&gt; chainCodes = new java.util.ArrayList&lt;java.lang.String&gt;();
        java.util.List&lt;java.lang.Integer&gt; residueSeqIds = new java.util.ArrayList&lt;java.lang.Integer&gt;();
        for (ccp.api.molecule.MolSystem.Chain chain: values) {
          for(ccp.api.molecule.MolSystem.Residue residue: chain.sortedResidues()) {
            chainCodes.add(chain.getCode());
            residueSeqIds.add(residue.getSeqId());
          }
        }
        /* NBNB TBD Add override and try-except */
        setChainCodes(chainCodes);
        setMolSystemCode(molSystemCode);
        setResidueSeqIds(residueSeqIds);
        /* NBNB TBD end override and try-except */
      }
    }
  } else {
    throw new memops.general.ApiException("Chains are from different MolSystems: " + values);
  }
} else {
  throw new memops.general.ApiException("MolResidueData.chains can not be set to empty");
}</item>
      <item tag="python">if len(values) == 1:
  self.setChain(list(values).pop())
elif values:
  molSystems = set(x.molSystem for x in values)
  if len(molSystems) == 1:
    molSystemCode = molSystems.pop().code
    self.molSystemCode = molSystemCode
    chainCodes = []
    residueSeqIds = []
    for chain in values:
      residues = chain.sortedResidues()
      chainCodes.extend(len(residues)*[chain.code])
      residues.extend(x.seqId for x in residues)
    wasOverride = self.root.override
    self.root.override = True
    try:
      self.chainCodes = chainCodes
      self.molSystemCode = molSystemCode
      self.residueSeqIds = residueSeqIds
    finally:
      self.root.override = wasOverride
  else:
    raise ApiError("Chains are from different MolSystems: %s" % values)
else:
  raise ApiError("MolResidueData.chains can not be set to empty")</item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="setResidues"
   guid="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00016"
   container="www.ccpn.ac.uk_Fogh_2009-05-20-16:32:11_00003"
   isAbstract="false" isImplicit="false" isQuery="false" opType="set"
   scope="instance_level" visibility="public_vis">
    <documentation>setter for derived link residues</documentation>
    <target>www.ccpn.ac.uk_Fogh_2009-05-20-16:32:16_00006</target>
    <codeStubs>
      <item tag="java">/* NBNB TBD */</item>
      <item tag="python">if values:
  chainCodes = []
  residueSeqIds = []
  molSystemCodes = set(())
  for residue in values:
    chain = residue.chain
    chainCodes.append(chain.code)
    residueSeqIds.append(residue.seqId)
    molSystemCodes.add(chain.molSystem.code)

  if len(set(chainCodes)) == 1:
    del chainCodes[1:]

  if len(molSystemCodes) == 1:
    wasOverride = self.root.override
    self.root.override = True
    try:
      self.chainCodes = chainCodes
      self.molSystemCode = molSystemCodes.pop()
      self.residueSeqIds = residueSeqIds
    finally:
      self.root.override = wasOverride
  else:
    raise ApiError("Residues are from different MolSystems: %s" % values)
else:
  raise ApiError("Residues can not be set to empty")</item>
    </codeStubs>
  </MetaOperation>
</MetaClass>

